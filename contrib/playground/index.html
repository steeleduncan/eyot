<html>
  <head>
    <style>
      /* Reset and Base Styles */
      body {
          margin: 0;
          font-family: 'Inter', sans-serif;
          background: #1e1e1e;
          color: #d4d4d4;
      }

      /* Main Container */
      .playground {
          display: flex;
          height: 100vh;
          gap: 2px;
          background: #333; /* Acts as the divider line */
      }

      /* Panes */
      .editor-pane, .output-pane {
          flex: 1;
          display: flex;
          flex-direction: column;
          background: #1e1e1e;
      }

      /* Pane Headers */
      header {
          padding: 10px 20px;
          background: #252526;
          font-size: 0.8rem;
          text-transform: uppercase;
          letter-spacing: 1px;
          border-bottom: 1px solid #333;
      }

      /* Input & Output Areas */
      textarea, #output-display {
          flex: 1;
          padding: 20px;
          font-family: 'Fira Code', 'Courier New', monospace;
          font-size: 14px;
          border: none;
          outline: none;
          resize: none;
      }

      textarea {
          background: #1e1e1e;
          color: #9cdcfe;
          line-height: 1.5;
      }

      #output-display {
          background: #000;
          color: #4af626; /* Classic "terminal" green */
          white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div class="playground">
      <section class="editor-pane">
        <header>Eyot</header>
        <textarea id="code-input" spellcheck="false" placeholder="// Write code here..."></textarea>
      </section>

      <section class="output-pane">
        <header id="output-header">Output</header>
        <div id="output-display">Program results will appear here...</div>
      </section>
    </div>

    <script>
      const input = document.getElementById('code-input');
      const output = document.getElementById('output-display');
      const outputHeader = document.getElementById('output-header');

      input.addEventListener('keydown', (e) => {
          if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
              runCode();
          }
      });

      async function runCode() {
          const payload = {
              version: 1,
              source: input.value,
          };
          
          try {
              const response = await fetch("/run", {
                  method: 'POST',
                  // Curl defaults to 'application/x-www-form-urlencoded' for --data, 
                  // but most modern APIs expect JSON. I'll use JSON here:
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(payload)
              });
              
              const result = await response.json();
              console.log(result);

              if (result.CompileSuccess) {
                  outputHeader.innerText = "Output";
                  output.innerText = result.Log;
              } else {
                  outputHeader.innerText = "Compiler failure log";
                  output.innerText = result.CompileLog;
              }

          } catch (error) {
              console.log("error = ", error)
              output.innerText = "Failed to process";
              output.style.color = "#ff5555"; // Red for errors
          }
      }
    </script>
  </body>
</html>
